<!DOCTYPE html>
<!-- List of HTML Tags supported by tkhtmlview:
see https://github.com/bauripalash/tkhtmlview?tab=readme-ov-file#html-support -->
<html>
<body>
<div style="color: THEME_COLOR; font-size: 14px;">
	<!-- <h1 style="text-align: center;">RSNA DICOM Anonymizer Project Settings</h1> -->

		<h2>Project Settings</h2>
		<ul>
			<li>The setting names are listed in the left column and the corresponding values or options are in the right column.</li> 
			<li>Most settings can be configured by clicking the corresponding blue button.</li>
			<li>Each setting is described below:</li>
		</ul>
		<img src="assets/locales/en_US/html/images/NewProjectSettings.png"/>

			<h3>Site ID</h3>
			<ul>
				<li>The Site ID is either auto-generated or parsed from a Java Anonymizer Index File (Index.xlsx).</li>
				<li>The Site ID <b>cannot be changed</b> after project creation.</li>
				<li>The Site ID is written as the first entry in the private block (0013,1001) of every anonymized DICOM file.</li>
				<li>The Site ID appears within square brackets in the title bar of the dashboard, following the project name when a project is open.</li>
			</ul>
				<h4>Auto-generation</h4>
				<ul>
					<li>The Site ID is auto-generated by the Anonymizer when a new project is created.</li>
					<li>To ensure uniqueness, it is time-based and equal to the number of 30 minute intervals since 1 Jan 1970.</li>
				</ul>
				<h4>Configure project by importing Java Anonymizer Index File (Index.xlsx)</h4>
				<ul>
					<li>If the user clicks the <i>Load Java Index File</i> button and imports the contents of a Java Anonymizer index file, the Site ID will be parsed from the first study row read from the index file.</li>
					<li>The data of all studies in the index file will be imported into the Anonymizer database to ensure unique UIDs continue to be generated for the project.</li>
				</ul>

			<h3>Project Name</h3>
			<ul>
				<li>The project name must be less than 16 characters.</li> 
				<li>The project name is written as the second entry in the private block (0013,1003) of every anonymized DICOM file.</li>
				<li>The project name is used as the default directory name for the Anonymizer store, see the Storage Directory setting below.</li>
				<li>The project name appears in the title bar of the dashboard of an open project followed by the Site ID in square brackets.</li>
				<li>The project name <b>cannot be changed</b> after project creation.</li>
			</ul>

			<h3>UID Root</h3>
			<ul>
				<li>The UID Root forms the prefix of all DICOM UIDs generated by the Anonymizer for this project.</li>
				<li>By default it is set to the RSNA UID Root.</li> 
				<li>The UID Root <b>cannot be changed</b> after project creation.</li>
				<li>The Anonymizer generates sequential UIDs for a project with the format: <i>"[UID Root].[Site ID].[N]"</i> where N is the integer sequence number.</li>
			</ul>

			<h3>DICOM Servers</h3>
				<h4>Local Server</h4>
				<img src="assets/locales/en_US/html/images/LocalServer.png"/>
				<ul>
					<li>The local server acts as both the DICOM Service Class Provider (SCP) and the Service Class User (SCU) for the Anonymizer.</li>
					<li>The Address drop down box is populated with the IP addresses of the network interfaces of the local machine.</li>
					<li>When a project is opened, the local SCP is started and listens for incoming DICOM associations on the selected address, specified port and AE Title.</li>
					<li>The local SCP will accept associations from <b><i>any</i></b> remote SCU calling the specified AE Title.</li>
					<li>When a project is closed, the local server SCP is stopped.</li>
					<li>The local server SCU is allocated ports from the operating system for outgoing DICOM associations but uses the same address and AE Title as the SCP.</li>
				</ul>

				<h4>Query Server</h4>
				<img src="assets/locales/en_US/html/images/QueryServer.png"/>
				<ul>	
					<li>The query server is the remote DICOM Service Class Provider (SCP) that the Anonymizer will query and retrieve DICOM files from.</li>
					<li>If necessary and supported by the network architecture, the query server address can be found using its domain name through a DNS lookup.</li>
					<li>The query server address, port and AE Title specifies how the query SCP listens for incoming DICOM associations.</li> 
					<li>The Anonymizer's local SCU details will typically need to be added to the remote server's allowed DICOM SCU's tables to allow access.</li>
					<li>The query server must be configured to allow the Anonymizer SCU to perform C-ECHO, C-FIND and C-MOVE requests.</li>
					<li>The query server must be configured with the Anonymizer SCP destination details (address, port, AE Title).</li>
					<li>The Anonymizer local SCU retrieves DICOM studies and their associated files from the query server by issuing DICOM C-MOVE requests at a user specified level.</li>
					<li>The Anonymizer local SCP receives the files from the query server on a separate association from which the request was made (as per the C-MOVE protocol).</li>
					<li>The details of the query and import process can be found in the <i>Query, Retrieve & Import View</i> section below.</li>
				</ul>

				<h4>Export Server</h4>
				<img src="assets/locales/en_US/html/images/ExportServer.png"/>
				<ul>	
					<li>The export server is the remote DICOM Service Class Provider (SCP) that the Anonymizer will send DICOM files to.</li>
					<li>If necessary and supported by the network architecture, the export server address can be found using its domain name through a DNS lookup.</li>
					<li>The export server address, port and AE Title specifies how the export SCP listens for incoming DICOM associations.</li> 
					<li>The Anonymizer's Local SCU details will typically need to be added to the remote export server's allowed DICOM SCU's tables to allow access.</li>
					<li>The export server must be configured to allow the Anonymizer SCU to perform C-ECHO, C-FIND and C-SEND requests.</li>
					<li>The Anonymizer SCU sends DICOM studies and their associated files to the export server by issuing DICOM C-SEND requests at a user specified level.</li>
					<li>The details of the export process can be found in the <i>Export View</i> section below.</li>
				</ul>
				
			<h3>AWS S3 Server</h3>
			<img src="assets/locales/en_US/html/images/AWSCognitoCredentials.png"/>
			<ul>
				<li>The AWS Cognito Credentials dialog captures the parameters required for the Anonymizer to send anonymized studies to an AWS S3 storage bucket as an AWS Cognito application user.</li>
				<li>The default values, except for Username and Password are the values required to send to the RSNA Imaging Archive.</li>
				<li>Contact RSNA Informatics department for registering your Site ID & Project to receive a Username and Password for exporting to their archive.</li>
				<li>To configure a custom AWS S3 installation requires the setup of a Cognito application, user and identity pool with ListBucket and PutObject permissions.</li>
				<li>The <i>Export to AWS</i> checkbox must be checked to enable AWS S3 Export instead of the DICOM Export Server.</li>
				<li>The details of the export process to AWS S3 can be found in the <i>Export View</i> section below.</li></li>
			</ul>

			<h3>Network Timeouts</h3>
			<img src="assets/locales/en_US/html/images/NetworkTimeouts.png"/>
			<ul>
				<li>The network timeouts are the maximum time the Anonymizer will wait for a response from a remote DICOM server before timing out.</li>
				<li>There are 4 different timeouts that are set in seconds and can be adjusted to suit the network conditions.</li>
				<li>The defaults are set to sensible values which should accommodate most servers.</li>
				<li>The Network Timeout will timeout if no expected activity has been detected from the remote server.</li>
				<li>The Network Timeout is the most likely timeout which may require tuning.</li>
			</ul>

			<h3>Storage Directory</h3>
			<img src="assets/locales/en_US/html/images/StorageDirectory.png"/>
			<ul>
				<li>The storage directory is a local file system location where the Anonymizer stores the anonymized files and all project data.</li>
				<li>By default the storage directory is created off the user home directory: <b><i>/Documents/RSNA Anonymizer/ProjectName (see above)</i></b></li>
				<li>The project data file: <b><i>ProjectModel.pkl</i></b> stores the project settings is stored in the root of the storage directory.</li>
				<li>Two sub-directories are created off the storage directory root: <b><i>/private</i></b> and <b><i>/public</i></b>.</li>
				<li>The <b><i>/private</i></b> sub-directory contains <i>Private Health Information (PHI)</i> extracted from incoming DICOM files.</li>
				<li>The anonymizer data file: <b><i>/private/AnonymizerModel.pkl</i></b> stores the PHI data in a compressed form.</li>
				<li>The various <b><i>/private/quarantine</i></b> sub-directories are created as the errors are detected in incoming files.</li>
				<li>The <b><i>/private/phi_export</i></b>sub-directory stores all PHI patient lookup files created from the Export View by clicking <i>Create Patient Lookup</i></li>
				<li>The <b><i>/public</i></b> sub-directory contains the anonymized files with structure: <b><i>/public/[anonymized_patient_id]/[study_uid]/[series_uid]/[instance_uid].dcm</i></b></li>
				<li>The storage directory <b>cannot be changed</b> after project creation.</li>
			</ul>

			<h3>Modalities</h3>
			<img src="assets/locales/en_US/html/images/Modalities.png"/>
			<ul>
				<li>The Modalities dialog lists the imaging modalities typically found in radiology.</li>
				<li>Click a line item to select/unselect a modality. A selected modality will be highlighted in blue.</li>
				<li>The Anonymizer will only accept files with modalities matching those selected here.</li>
				<li>There is a one-to-many relationship between a modality and storage class.</li>
				<li>The Anonymizer will automatically create a list of allowed storage classes corresponding to the currently selected modalities.</li>
				<li>Storage classes can be edited by the Storage Classes dialog below.</li>
			</ul>

			<h3>Storage Classes</h3>
			<img src="assets/locales/en_US/html/images/StorageClasses.png"/>
			<ul>
				<li>The storage classes dialog lists all the current DICOM storage classes defined by the standard.</li>
				<li>The list of storage classes implied by the modality selection above can be confirmed and/or edited here.</li>
				<li>Click a line item to select/unselect a storage class. A selected storage class will be highlighted in blue.</li>
				<li>After any edits, clicking the <b><i>From Modalities</b></i> button will reset to a list of storage classes implied by the currently selected modalities.</li>
			</ul>

			<h3>Transfer Syntaxes</h3>
			<img src="assets/locales/en_US/html/images/TransferSyntaxes.png"/>
			<ul>
				<li>The Transfer Syntaxes dialog lists the data formats currently supported by the Anonymizer.</li>
				<li>The first 4 transfer syntaxes do not use image compression and are selected by default.</li>
				<li>The other transfer syntaxes provide support for JPEG image compression with different algorithms.</li>
				<li>The selected storage classes combined with the selected transfer syntaxes determine which DICOM files are accepted by the Anonymizer.</li>
				<li>The presentation and storage contexts, determined by the selected storage classes and transfer syntaxes are used in association negotiation when the Anonymizer acts as SCU and SCP.</li>
				<li>The Anonymizer does not transcode DICOM files from one transfer syntax to another.</li>
				<li>The transfer syntax of DICOM files received by the Anonymizer is preserved in the corresponding anonymized file.</li>

			</ul>

			<h3>Script File</h3>
			<ul>
				<li>The default script file which comes with this Anonymizer contains the instructions to meet the DICOM Standard de-identification protocol described in the corresponding help menu.</li>
				<li>Alternative script files can be loaded using this button to support more complex or legacy projects.</li>
				<li>If a different anonymizer script file is loaded be aware of the limitations as described in the overview section: differences from the Java Version.</li>	
			</ul>

			<h3>Logging Levels</h3>
			<img src="assets/locales/en_US/html/images/LoggingLevels.png"/>
			<ul>
				<li>The Anonymizer generates detailed logging information, capturing program activity at Debug, Info, Warning, Error and Critical levels, and stores it to file.</li>
				<li>There are up to 10 log files (max size: 100MB) in a rotating list.</li>
				<li>By default the storage directory is created off the user home directory: <b><i>/Documents/RSNA Anonymizer/logs</i></b></li>
				<li>The log output of both DICOM libraries PYDICOM and PYNETDICOM used by the Anonymizer can be controlled using this dialog.</li>
				<li><b>Warning: </b> when debug output is enabled for PYDICOM, PHI data will be written to the logs.</li>
				<li><a href=https://github.com/tmoreno/open-log-viewer/releases>Open Log Viewer</a> is an excellent, free, multi-platform application for viewing log files for more advanced users.</li>
			</ul>
			<img src="assets/locales/en_US/html/images/OpenLogViewer.png"/>

			

</div>
</body>
</html>